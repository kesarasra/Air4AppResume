<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Step 2: Location</title>
  <link rel="stylesheet" href="styles/style.css" />
  <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon.png">
</head>
<body>
  <header class="navbar">
    <img src="/static/images/logo.png" alt="Air4four Logo" class="site-logo">
    <h1>เครื่องบันทึกรายวัน</h1>
    <div>
        <button onclick="window.location.href='/'">บ้าน</button>
        <button onclick="window.location.href='/newitem'">รายการใหม่</button>
        <button onclick="window.location.href='/admin/view-log'">ดูแผ่นงาน</button>
        <button onclick="window.location.href='/logout'">ออกจากระบบ</button>
    </div>
  </header>
  <main class="container">
    <h1>ความสำเร็จ!</h1>
  <p>กิจกรรมของคุณถูกบันทึกแล้ว</p>
  <div class="btn-group">
    <button onclick="addAnother()">เพิ่มกิจกรรมอื่น</button>
    <button onclick="exitForm()">ออก</button>
  </div>
</main>

<script src="scripts/utils.js"></script>
<script>
  function addAnother() {
    // ✅ Step 1: Read session values before clearing
    const worker = getFromSession('workerName');
    const date = getFromSession('logDate');
    const lastWelcomed = getFromSession('lastWelcomedWorker');

    // ✅ Step 2: Clear everything
    sessionStorage.clear();

    // ✅ Step 3: Restore preserved data
    saveToSession('workerName', worker);
    saveToSession('logDate', date);
    saveToSession('lastWelcomedWorker', lastWelcomed);

    // ✅ Step 4: Go to location page
    window.location.href = 'location.html';
  }

  function exitForm() {
    const worker = getFromSession('workerName') || 'worker';

    // Show goodbye popup
    showPopup(`ทำได้ดีมากวันนี้, ${worker}.\nขอให้พักผ่อนให้สบาย!`, {
      className: 'goodbye',
      duration: 3000,
      sound: 'sounds/goodbye.wav'
    });

    // Delay redirect to allow popup to show
    setTimeout(() => {
      sessionStorage.clear();
      window.location.href = '/';
    }, 3000);
  }

</script>
